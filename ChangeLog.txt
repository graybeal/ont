org.mmisw.ont - Ontology and Term URI resolver 
Carlos Rueda - MMI / MBARI

ChangeLog

2003-04-01
	- HtmlDispacher.appendHtmlIfResolvableByThisService is now the way to properly
	  prepare refered resources that are resolvable by the service (so they are links 
	  to the HTML format as well).
	
	
2003-03-27
	- UriResolver: some doc updates and minor code re-arrangements (no changes in logic)
	
	- JenaUtil2: some pending renamings done:
		getURIForBase --> removeTrailingFragment
		getURIForNS   --> appendFragment
	
	- Sparql: enabled DESCRIBE responses.
	
	- Fixed 100: "term URI always resolved in HTML"
		- TermExtractor: extracts a model with information about the requested entity.
		- UriResolver._resolveUriOntFormat: serialized resulting model in the requested format. 
	
2003-03-21
	- Just comment about Omv.acronym saying that is about "resourceType" not "shortName"
       
	 
2003-03-19:   (1.0.0.beta)
	- Issue 8: "Improve HTML response"
	  Added a header with logo and links to semanticframework

2003-03-17:   (0.2.0.beta7)
	- Code clean-up:
		- Removed unused types: MdDispatcher, MdHelper, AttrGroup, AttrDef.
		  Medatada is handled in "ontmd" project. See 2008-11-14 comment below.
		
		
		
2003-03-16:
	- Fixed Issue 102: "searches should be against the "unversioned" form of the latest ontologies"
 	  See OntGraph.
 	  NOTE: *only* the "unversioned" latest versions are loaded into the graph so all
	  responses will be now in unversioned form.
	  Fix available as of 0.2.0.beta6
	  
	- Sparql: make links for good URLs in html response. The ones that are good MmiUri's are
	  appended ".html" so the HTML output format is transferred for subsequent resolution.
	  This fixes Issue 103: "make links for well formed URLs in HTML query reponse"
 	  

2009-03-15:
	- Fixed issue 101: "Inexistent term is resolved"
	  The "problem" was that model.getResource "behaves identically to createResource(String)"
	  so it *creates* a fresh resource if the resource does NOT exist!
	  See http://jena.sourceforge.net/javadoc/com/hp/hpl/jena/rdf/model/Model.html#getResource(java.lang.String)
	  I was using the call ``termRes = model.getResource(termUri)'', along with a termRes != null check to 
	  determine the existence of the term. The fix is to use an explicit "contains" check.
	  Also removed the try with the "#" separator as we are now only using "/".
	  A 404 is returned now as well.
	  This is fixed in HtmlDispatcher.dispatchTerm() which is currently the only place where
	  term URIs are being resolved.  See issue #100: "term URI always resolved in HTML"
	  
	- Sparql: Unused prefixes (except "") are now removed from the CONSTRUCT output.
	  New JenaUtil2.removeUnusedNsPrefixes(Model model);
	  
	  
	- New version.properties to handle version information for this service. build.xml translates
	  this to the application via the web.xml (which is read by OntConfig). Also, a "build number",
	  which is a timestamp, is used for the full version. 
	  
	  
2009-03-14:
	- The following kind URI was accepted as valid:
	       http://mmisw.org/ont/mmi/badversion/someVocab/someTerm
	  Fixed.  See MmiUri public constructor and MmiUriTest.testVersionInvalid2().
	  
	  
	- Completed review of MmiUri and simplification of constructor and operations.
	  In particular, the "extension" concept has been re-worked; now, the extension is
	  provided by getExtension() (instead of getTopicExtension(), which has been removed).
	  This extension can be specified in the topic component (as before) but also in the
	  term component, for example:
	      http://mmisw.org/ont/mmi/someVocab/someTerm.owl
	  But now, the extension is NOT included in any of the query operations, except, of course
	  getExtension() itself. In general, the extension is to be used just as a way to help determine
	  the output format desired by the requester. 
	  Note also that the ontology URIs are never stored in the database with any extension.
	  
	- Fixed issue #51: "Fix unversioned HTML to be unversioned".
	
	
2009-03-13:
	- working on issue 51: "Fix unversioned HTML to be unversioned", in concrete the problem
	  I described in today's comment.
	
	
2009-03-03
	Resuming work on issue 62: unversioned terms not resolving 
	http://code.google.com/p/mmisw/issues/detail?id=62&sort=priority
	
	- adding some more log information
	- MmiUri.getOntologyUri() was not honoring its documentation that says only the
	  URI for the ontology is returned (not including the term, if any). However, this was
	  not proporly guaranteed. Fixed.
	
	
2008-12-29   0.2.0.beta3 (20081229)
	- sparql: "select" query now also process new "form" parameter, which can be
	  "html" (the default) or csv.
	- updated sparql.html page.
	
	- dispatch new commands: vocabs, mappings.  
	  Parameter "uv" can be used to get both unversioned and versioned URIs: uv=true.  
	  By default, only unversioned URIs are returned.
	  display_label included in output

2008-12-03   0.2.0.beta2 (20081203)
	- Dispatch the "root" request to report information about this service, ie.
	      http://mmisw.org/ont/
	  now reports something like:
	  
				  MMI Ontology URI Resolver
			This service is part of the MMI Semantic Framework
			
			MMI Ontology URI Resolver. Version 0.2.0.beta2 (20081203)

	  instead of returning 404.
	
	
2008-11-18   0.2.0.beta2 (20081118)
	- 62: default URL not resolving 
	Db.getOntologyVersions: the term component in the given URI is ignored.
	
	
2008-11-14  0.2.0.beta (20081114)
	
	- Issue 53: unversioned reponse wrong for "slash" ontologies 
	UnversionedConverter: Using JenaUtil2 to handle the fragments as in OntMd
	(TODO JenaUtil2.java is a copy of the same file on ontmd -> unify in a libray)
	
	
	- resolve term in html:  First, try with / separator; then with #
	  Note: jena resolves a request with #, even if everything in the ontology
	  is defined in terms of the slash. Then, since the tries were #-then-/ before,
	  the # resolution was OK but made the rest of the dispatch unable to find
	  statametes associated with the term.  With the new order /-then-#, this
	  is now correct.
	
	- Deprecating MdDispatcher - MD display no longer done here (use ontmd instead)
	TODO: See if MdHelper can also be deprecated/removed when doing code clean-up
	
	
2008-11-13  0.2.0.beta (20081113)
	- preliminary tests of unversioned response seem OK
	  Issue 24, part 2): http://code.google.com/p/mmisw/issues/detail?id=24
	  
	  
2008-11-12
	- Starting "unversioned" version request dispatch
	
	
	
2008-11-11   (Happy B-day Ini!)
	- MmiUri.LATEST_VERSION_INDICATOR = "$"
	
	- Issue 27: URIs have # signs instead of / before terms:
		All URIs starting with http://mmisw.org/ont/ will get the "#" (if any) 
		replaced by "/".   I think this works pretty well, I mean, not only as a 
		temporary solution, but also that it won't hurt once the submitted ontologies
		get the namespace with the "/" fragment separator.
	

2008-11-10
	- Rule added: (a.2) an OWL document if is the user-agent is "Java/*"
		This is a workaround for the following situation in VINE:
		The underlying Jena library should include the accept element:
		"application/rdf+xml" but it's not doing so, see bug:
		   Wrong Accept-Header in HTTP-Connections - ID: 1424091
		   http://sourceforge.net/tracker2/?func=detail&aid=1424091&group_id=40417&atid=430288
	
	
2008-11-04
	Re. 24: unversioned and latest-version requests
		- Accept dash ('-') as a valid version in an ontology URI request.
		- The dash requst is handled with a "redirect" to the actual latest version
		- the "unversioned" request is still handled as usual: it simple returns the
		  contents of the latest version without any modification.
	
	
2008-11-03
	- _getFullPath: try with or without ".owl" extension
	
2008-11-02
	- UriResolver: now reportin PC-Remote-Addr; also googlebot check disabled as the
	  the robots.txt is now active.
	
	- Db: log.warn instead of throwing the exception in the _con.close() call (sometimes
	  an "already closed" exception is thrown --perhaps some pooling/cache thing-- but 
	  showing the error to the end-user is not necessary)
	
	
2008-11-01
	- New Db.getOntologyVersions(MmiUri mmiUri) to get the versions of a given
	  ontology. The given mmiUri is used to create the query wildcard, ie, the 
	  version part (mmiUri.getVersion()) is ignored.
	  
	- Issue 23: Resolve latest version
	  See UriResolver._resolveUri:
	  	If version is not explicitly requested, find the latest version of the
	  	corresponding ontology (using "%" for version wildcard and the other components
	  	in the URI), and continue regular processing with the URI found.
	  	Note: topic extension is handled with a trailing ".%" to the base topic without
	  	extension. Note: the dot is important to avoid getting topics that have the topic 
	  	in question as suffix.
	  	
	  
	- Convenience parameter "_versions" to report the versions of a requested mmiUri, ex:
	    http://mmisw.org/ont/mmi/parameter/?_versions
	
	
2008-10-30
	 - Issue 14: "mysql db connection timeout error"
	   http://code.google.com/p/mmisw/issues/detail?id=14
	   
	   Db.java: move DataSource lookup to the init() method.
	   Ref: http://www.ibm.com/developerworks/websphere/library/bestpractices/using_httpservlet_method.html
	   TODO: still need to see if this helps solve the issue.
	   
	   Also, closing all connections after they are used.
	   
	 - Not resolving request with extension (eg., .../topic.html) when the original URI
	   in the db is with no extension (eg, .../topic). -- Fixed.
	   
	 - Now using pattern: ^yyyy[mm[dd][Thh[mm[ss]]]$ to validate a non-null version string
	   in the ontology URI.
	   
	 
2008-10-29
	- show requested URI, remote host, and user-agent 
	- return no-content to googlebot
	
	
2008-10-24
	build.xml: added "voc-jar" target to create org.mmisw.ont.vocabulary.jar to facilitate
	the current updates in the voc2rdf project.
	(note: these vocabularies could be located in an independed project).
	
2008-10-23
	Paul:  Carlos, got an update: we're now using your table formatting, including CSS, on the
	metadata table when we show ontologies. If you could change your output again (sorry) to 
	only put out the contents of the table (starting with <tr> instead of <table>) then I 
	think it will become seamless.
	
	--> done.
	

2008-10-22
	- HTML output improved a bit. New class HtmlDispatcher.
	- doPost was calling super.doGet!! (a typo).  Fixed.
	- Sparql "select" response now in HTML.
	- Util.{toHtml,toHtmlComment}() added to avoid inserted code
	  in html responses.
	  TODO: use in ALL html output.
	
	
2008-10-21
	- Starting handling of metadata vocabularies.
	- New package package org.mmisw.ont.vocabulary:
	     Omv: Vocabulary definitions for Omv
	     OmvMmi: Vocabulary definitions for OmvMmi
	  The definition are based on the current contents of:
	     http://marinemetadata.org/files/mmi/OntologyExampleOMV.owl
	  which I saved in the same package for reference.
	  
	- Dispatching the metadata:
		"_md" parameter used to display the metadata, example:
		     http://mmisw.org/ont/foo/mytopic.owl?_md
		(I added some of the new attributes in mytopic.owl for testing).
	  Main classes:
		MdDispatcher: Dispatches the metadata output
		MdHelper: Handles the metadata attributes.
	
	
2008-10-20
	- MmmUri: fixed getTermUri();  new getTopicExtension().
	
	- First implementation of the current Dereferencing rules, but unfinished.
	- Accept: A helper class to query the "accept" header values.
	- "form" parameter also handled. If given, this parameter takes precedence
	  over the file extension.
	  
	- parameter "info" changed to "_debug"
	
	
	
2008-10-19
	- new convenience annotation @org.mmisw.ont.util.Unfinished
	- sparql stuff moved to package org.mmisw.ont.sparql
	- package-info.java files added
	
	- sparql queries now working
	- "construct" and "select" queries accepted and processed.
	- WebContent/sparql.html - tests page
	
	
2008-10-18  v. 0.1.1 (20081018)
	- General code clean-up (loggers, non "static" classes)
	- New OntConfig to handle configuration parameters; removed hard-coded params.
	
2008-10-17
	- main.css: normal font (instead of x-small)
	- minor logging changes
	
	
2008-10-16
	- Preliminaries for resolving terms
	
	- Process xslt for output of sparql query (with xslt parameter)
	- Inline stylesheet with xslti parameter, but not working yet (in firefox at least)
	 

2008-10-15
	- OntGraph: load all ontologies into memory
	- Added sparql support: .../ont?sparql=CONSTRUCT  { ?s ?p ?o } where{?s ?p ?o. } LIMIT 20
	  TODO testing
	- Internal request to reload ontologies: .../ont?_reload
	  TODO (perhaps): set up quantum (cronjob) to do the reload 
	  
	- Db.getOntologies: Fixed link to obtaing ontologies:
	  The correct link between the two tables is:
	    v_ncbo_ontology.id  ==  ncbo_ontology_file.ontology_version_id
	
	
2008-10-13
	- added "list" parameter: shows the list of ontologies as a convenience for
	  testing the existing entries in the database.
	  
	  Note that all these convenience parameters shouldn't be visible for the
	  general user.
	  
	- added logging mechanism.
	  
	
2008-10-12
	- Initial version 0.1.0
	- NOTE: <version> component not yet handled.
	
	Note: mysql driver not included in the project nor in the generated war.
	Instead, this application assumes the driver to be available in the container.
	(I saved it under <apache-tomcat-home>/lib/ on mmi).
